{% extends "base.html" %}

{% block title %}My Lists{% endblock %}

{% block content %}
<div class="win95-window">
  <!-- Title bar -->
  <div class="win95-titlebar">
    <span class="title-text">Todo Lists</span>
    <div class="win95-titlebar-buttons">
      <button class="win95-titlebar-btn">_</button>
      <button class="win95-titlebar-btn">&#9633;</button>
      <button class="win95-titlebar-btn">X</button>
    </div>
  </div>

  <!-- Window body -->
  <div class="win95-body">

    <!-- Toolbar: New List -->
    <div class="win95-toolbar">
      <button class="win95-btn" onclick="toggleNewListForm()">New List</button>
    </div>

    <!-- Inline new-list form -->
    <div class="inline-form" id="new-list-form">
      <form method="POST" action="{{ url_for('create_list') }}">
        <div class="form-row">
          <label for="new-list-name">Name:</label>
          <input type="text" name="name" id="new-list-name"
                 class="win95-input" placeholder="List name..." required>
          <button type="submit" class="win95-btn primary">OK</button>
          <button type="button" class="win95-btn" onclick="toggleNewListForm()">Cancel</button>
        </div>
      </form>
    </div>

    <!-- List of lists in a sunken panel -->
    <div class="win95-sunken" style="min-height: 200px; max-height: 380px;">
      {% if list_data %}
        {% for item in list_data %}
        <div class="list-row" id="list-row-{{ item.list.id }}">
          <a class="list-name" href="{{ url_for('show_list', list_id=item.list.id) }}">
            {{ item.list.name }}
          </a>
          <span class="list-meta">{{ item.done }}/{{ item.total }}</span>
          <div class="list-actions">
            <button class="win95-btn"
                    onclick="startEditList({{ item.list.id }}, '{{ item.list.name|e }}')"
                    title="Rename">Ren</button>
            <button class="win95-btn danger"
                    onclick="confirmDeleteList({{ item.list.id }})"
                    title="Delete">Del</button>
          </div>
        </div>

        <!-- Edit row (hidden by default) -->
        <div class="edit-row" id="edit-list-{{ item.list.id }}">
          <form method="POST" action="{{ url_for('edit_list', list_id=item.list.id) }}"
                style="display:flex; align-items:center; gap:4px; width:100%;">
            <input type="text" name="name" class="win95-input"
                   id="edit-list-input-{{ item.list.id }}" required>
            <button type="submit" class="win95-btn primary">OK</button>
            <button type="button" class="win95-btn"
                    onclick="cancelEditList({{ item.list.id }})">Cancel</button>
          </form>
        </div>

        <!-- Delete confirmation (hidden by default) -->
        <div class="edit-row" id="delete-list-{{ item.list.id }}">
          <span style="flex:1; font-size:14px; color:#cc0000;">
            Delete "{{ item.list.name }}" and all its todos?
          </span>
          <form method="POST" action="{{ url_for('delete_list', list_id=item.list.id) }}"
                style="display:inline-flex; gap:4px;">
            <button type="submit" class="win95-btn danger">Yes</button>
            <button type="button" class="win95-btn"
                    onclick="cancelDeleteList({{ item.list.id }})">No</button>
          </form>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">
          No lists yet. Click "New List" to create one.
        </div>
      {% endif %}
    </div>

  </div>

  <!-- Status bar -->
  <div class="win95-statusbar">
    <div class="status-section">
      {{ list_data|length }} list{{ 's' if list_data|length != 1 else '' }}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleNewListForm() {
  var form = document.getElementById('new-list-form');
  form.classList.toggle('active');
  if (form.classList.contains('active')) {
    document.getElementById('new-list-name').focus();
  }
}

function startEditList(id, currentName) {
  document.getElementById('list-row-' + id).style.display = 'none';
  var editRow = document.getElementById('edit-list-' + id);
  editRow.classList.add('active');
  var input = document.getElementById('edit-list-input-' + id);
  input.value = currentName;
  input.focus();
  input.select();
}

function cancelEditList(id) {
  document.getElementById('edit-list-' + id).classList.remove('active');
  document.getElementById('list-row-' + id).style.display = '';
}

function confirmDeleteList(id) {
  document.getElementById('list-row-' + id).style.display = 'none';
  document.getElementById('delete-list-' + id).classList.add('active');
}

function cancelDeleteList(id) {
  document.getElementById('delete-list-' + id).classList.remove('active');
  document.getElementById('list-row-' + id).style.display = '';
}
</script>
{% endblock %}
